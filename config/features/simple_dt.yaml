# ====================================================================================
# SIMPLE DECISION TREE FEATURE CONFIGURATION (PHASE 1)
# ====================================================================================
# Feature set for GA-optimized decision tree policy with NMC bypass + three sweeps.
# Includes core per-aircraft health indicators plus DA line deviation metric.
#
# Use Case: Phase 1 - Flat decision tree with bucket classification
# Dimensionality: 4 features × 8 aircraft = 32 features
# Chromosome Size (depth=3): 7 splits + 7 thresholds + 8 buckets + 2 params = 24 genes
# Tree Structure: 8 leaves, 4 buckets (1=PREVENTIVE_ELIGIBLE, 2=LIKELY_DONT_FLY,
#                                      3=COULD_FLY, 4=SHOULD_FLY)
# ====================================================================================

name: "simple_dt"
description: "Phase 1 - Decision tree with per-aircraft health + DA line deviation"
dimensionality: 32  # 4 features × 8 aircraft
policy_type: "decision_tree"
tree_depth: 3  # 8 leaves
n_buckets: 4  # Buckets 1-4 for FMC aircraft classification

# ====================================================================================
# PER-AIRCRAFT FEATURES (4 features × 8 aircraft = 32 total)
# ====================================================================================
per_aircraft_features:
  # Health metric: Remaining useful life
  - name: "observed_rul"
    type: "float"
    source: "aircraft.observed_rul"
    description: "Remaining useful life from sensor (with noise)"
    normalization: "none"
    bounds: [0, 258]
    priority: "high"

  # Phase maintenance indicators
  - name: "hours_to_major"
    type: "float"
    source: "derived"
    formula: "500 - aircraft.hours_since_major_phase"
    description: "Hours until major phase maintenance required (can be negative if overdue)"
    normalization: "none"
    bounds: [-2, 500]  # Can go negative if aircraft flew beyond 500 hours
    priority: "high"

  - name: "hours_to_minor"
    type: "float"
    source: "derived"
    formula: "250 - aircraft.hours_since_minor_phase"
    description: "Hours until minor phase maintenance required (can be negative if overdue)"
    normalization: "none"
    bounds: [-2, 250]  # Can go negative if aircraft flew beyond 250 hours
    priority: "high"

  # DA line synchronization metric (signed: positive=behind, negative=ahead)
  - name: "da_line_deviation"
    type: "float"
    source: "derived"
    formula: "da_line_deviation"
    description: "Signed deviation from ideal DA line (actual - ideal hours_to_major). Positive = behind schedule (more bank hours, low utilization, should fly). Negative = ahead of schedule (fewer bank hours, high utilization, protect)."
    normalization: "none"
    bounds: [-500, 500]  # Symmetric bounds matching theoretical range
    priority: "medium"

# ====================================================================================
# FLEET-LEVEL FEATURES - DISABLED FOR PHASE 1
# ====================================================================================
fleet_features: []

# ====================================================================================
# MISSION FEATURES - DISABLED FOR PHASE 1
# ====================================================================================
mission_features: []

# ====================================================================================
# TEMPORAL FEATURES - DISABLED FOR PHASE 1
# ====================================================================================
temporal_features: []

# ====================================================================================
# NORMALIZATION SETTINGS
# ====================================================================================
normalization:
  method: "minmax"  # Scale features to [0, 1] range
  handle_missing: "zero"  # Replace missing/NaN with 0.0
  clip_outliers: true  # Clip values beyond bounds
  outlier_std_threshold: 3.0  # Clip at ±3 standard deviations

# ====================================================================================
# ENCODING SETTINGS
# ====================================================================================
encoding:
  categorical_method: "binary"
  status_encoding:
    FMC: 1.0
    NMC: 0.0

# ====================================================================================
# DECISION TREE POLICY SETTINGS
# ====================================================================================
decision_tree:
  # Tree structure
  depth: 3  # 2^3 = 8 leaves
  n_leaves: 8
  n_splits: 7  # 2^3 - 1

  # Bucket configuration
  n_buckets: 4
  bucket_names:
    1: "PREVENTIVE_ELIGIBLE"
    2: "LIKELY_DONT_FLY"
    3: "COULD_FLY"
    4: "SHOULD_FLY"

  # Gradient initialization settings
  gradient_initialization:
    enabled: true
    noise_sigma: 0.5  # Gaussian noise for bucket initialization

  # Mutation settings
  mutation:
    gradient_pull_probability: 0.6  # 60% pull toward expected bucket value
    threshold_sigma: 0.1  # Gaussian noise for threshold mutation
    early_phase_window_range: [0, 100]  # Hours before phase trigger

  # Action assignment sweeps
  sweeps:
    - name: "mandatory_maintenance"
      order: "forward"
      buckets: [0]  # NMC aircraft only
      priority: "highest"

    - name: "flying_assignment"
      order: "reverse"  # Buckets 4 → 3 → 2 → 1
      buckets: [4, 3, 2, 1]
      priority: "high"
      tiebreaker: "learned"  # Use chromosome.tiebreak_feature

    - name: "preventive_maintenance"
      order: "forward"  # Buckets 1 → 2 → 3 → 4
      buckets: [1, 2, 3, 4]
      priority: "medium"

# ====================================================================================
# FEATURE IMPORTANCE TRACKING (FOR ANALYSIS)
# ====================================================================================
feature_analysis:
  track_importance: true  # Log which features GA uses most frequently
  log_splits: true  # Record which features appear at each tree depth
  correlation_threshold: 0.95  # Flag highly correlated features
