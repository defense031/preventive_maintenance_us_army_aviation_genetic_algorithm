# ====================================================================================
# FULL FEATURE CONFIGURATION
# ====================================================================================
# Complete feature set including per-aircraft, mission, and fleet-level context.
# Incorporates DA line metrics (clustering, capacity strain) and resource availability.
#
# Use Case: Final optimization, publication-quality results
# Dimensionality: ~68 features (6 per-aircraft × 8 + 5 mission + 8 fleet = 61 features)
# Chromosome Size: Depth-4 tree = 15 splits + 15 thresholds + 80 leaf scores = 110 genes
# ====================================================================================

name: "full"
description: "Complete feature set - per-aircraft + mission + fleet context"
dimensionality: 61  # 6 × 8 + 5 + 8

# ====================================================================================
# PER-AIRCRAFT FEATURES (6 features × 8 aircraft = 48 total)
# ====================================================================================
per_aircraft_features:
  # Health metrics
  - name: "observed_rul"
    type: "float"
    source: "aircraft.observed_rul"
    description: "Remaining useful life from sensor (with noise)"
    normalization: "minmax"
    bounds: [0, 500]
    priority: "high"

  - name: "hours_to_minor"
    type: "float"
    source: "derived"
    formula: "250 - aircraft.hours_since_minor_phase"
    description: "Hours until minor phase maintenance required"
    normalization: "minmax"
    bounds: [-50, 250]
    priority: "high"

  - name: "hours_to_major"
    type: "float"
    source: "derived"
    formula: "500 - aircraft.hours_since_major_phase"
    description: "Hours until major phase maintenance required"
    normalization: "minmax"
    bounds: [-50, 500]
    priority: "high"

  # Status indicators
  - name: "status_fmc"
    type: "binary"
    source: "derived"
    formula: "1.0 if aircraft.status == 'FMC' else 0.0"
    description: "Binary indicator: 1 if FMC, 0 if NMC"
    normalization: "none"
    bounds: [0, 1]
    priority: "medium"

  - name: "flew_today"
    type: "binary"
    source: "aircraft.flew_today"
    description: "Binary indicator: 1 if aircraft flew today"
    normalization: "none"
    bounds: [0, 1]
    priority: "low"

  - name: "total_flight_hours"
    type: "float"
    source: "aircraft.total_flight_hours"
    description: "Cumulative flight hours (lifetime usage indicator)"
    normalization: "minmax"
    bounds: [0, 10000]
    priority: "low"

# ====================================================================================
# MISSION FEATURES (5 features total)
# ====================================================================================
mission_features:
  - name: "mission_today"
    type: "integer"
    source: "mission_forecast[0].required_aircraft"
    description: "Number of aircraft required for today's mission"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "high"

  - name: "mission_tomorrow"
    type: "integer"
    source: "mission_forecast[1].required_aircraft"
    description: "Mission requirement tomorrow (1-day lookahead)"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "medium"

  - name: "mission_peak_3day"
    type: "integer"
    source: "derived"
    formula: "max([m.required_aircraft for m in mission_forecast[:3]])"
    description: "Peak demand in next 3 days"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "medium"

  - name: "mission_avg_7day"
    type: "float"
    source: "derived"
    formula: "mean([m.required_aircraft for m in mission_forecast[:7]])"
    description: "Average demand next 7 days (tempo indicator)"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "low"

  - name: "mission_avg_14day"
    type: "float"
    source: "derived"
    formula: "mean([m.required_aircraft for m in mission_forecast[:14]])"
    description: "Average demand next 14 days (long-term planning)"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "low"

# ====================================================================================
# FLEET-LEVEL FEATURES (8 features total) - NEW IN FULL CONFIG
# ====================================================================================
# NOTE: Removed preventive_tokens, preventive_slots, phase_slots (post-hoc adjudication)
# Added mission forecasting features with decay weighting and reporting period tracking
fleet_features:
  # Operational readiness
  - name: "fmc_count"
    type: "integer"
    source: "derived"
    formula: "sum([1 for ac in aircraft if ac.status == 'FMC'])"
    description: "Total number of FMC aircraft (absolute count, not normalized)"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "high"

  # DA Line metrics (fleet synchronization)
  - name: "total_bank_hours"
    type: "float"
    source: "fleet_metrics['total_bank_hours']"
    description: "Sum of hours remaining before major phase (fleet capacity)"
    normalization: "minmax"
    bounds: [0, 4000]  # 8 aircraft × 500 hours max
    priority: "high"

  # Mission forecasting (14-day lookahead)
  - name: "mission_peak_14day"
    type: "integer"
    source: "derived"
    formula: "max([m.required_aircraft for m in mission_forecast[:14]])"
    description: "Peak demand in next 14 days (worst-case planning)"
    normalization: "minmax"
    bounds: [0, 8]
    priority: "high"

  - name: "mission_weighted_14day"
    type: "float"
    source: "derived"
    formula: "sum([mission_forecast[i].required_aircraft * (1.0 - i * 0.9 / 13.0) for i in range(min(14, len(mission_forecast)))])"
    description: "Weighted mission demand (linear decay: day 0=100%, day 13=10%)"
    normalization: "minmax"
    bounds: [0, 112]  # Max: 8 aircraft × 14 days (ignoring decay for bounds)
    priority: "high"

  # DA Line synchronization
  - name: "clustering"
    type: "float"
    source: "fleet_metrics['clustering']"
    description: "DA line clustering metric [0-1]: how bunched aircraft schedules are"
    normalization: "none"  # Already normalized
    bounds: [0, 1]
    priority: "medium"

  - name: "capacity_strain"
    type: "float"
    source: "fleet_metrics['capacity_strain']"
    description: "Exponential strain metric [0-1]: pressure on maintenance capacity"
    normalization: "none"  # Already normalized
    bounds: [0, 1]
    priority: "medium"

  # Resource availability
  - name: "tokens_remaining"
    type: "integer"
    source: "state['tokens_remaining']"
    description: "Total maintenance tokens remaining this quarter"
    normalization: "minmax"
    bounds: [0, 30]  # Max tokens per quarter
    priority: "medium"

  # Temporal context (reporting period)
  - name: "days_until_report"
    type: "integer"
    source: "derived"
    formula: "days_until_reporting_period_end"  # Custom calculation (16th to 15th cycle)
    description: "Days until current reporting period ends (monthly OR finalized on 15th)"
    normalization: "minmax"
    bounds: [0, 30]  # Max days in reporting period
    priority: "medium"

# ====================================================================================
# TEMPORAL FEATURES - COULD ADD IN FUTURE
# ====================================================================================
temporal_features: []
  # Potential additions:
  # - is_quarter_end: Binary indicator for quarterly decision days
  # - fy_progress: Fiscal year progress [0-1]
  # - is_weekend: Binary indicator
  # - days_to_report: Days until quarterly report

# ====================================================================================
# NORMALIZATION SETTINGS
# ====================================================================================
normalization:
  method: "minmax"  # Scale features to [0, 1] range
  handle_missing: "zero"  # Replace missing/NaN with 0.0
  clip_outliers: true  # Clip values beyond bounds
  outlier_std_threshold: 3.0  # Clip at ±3 standard deviations

# ====================================================================================
# ENCODING SETTINGS
# ====================================================================================
encoding:
  categorical_method: "binary"
  status_encoding:
    FMC: 1.0
    NMC: 0.0

# ====================================================================================
# FEATURE IMPORTANCE TRACKING (FOR ANALYSIS)
# ====================================================================================
feature_analysis:
  track_importance: true  # Log which features GA uses most frequently
  log_splits: true  # Record which features appear at each tree depth
  correlation_threshold: 0.95  # Flag highly correlated features
